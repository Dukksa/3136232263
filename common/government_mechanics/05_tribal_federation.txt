tribal_federation_mechanic = {
	alert_icon_gfx = GFX_alerticons_government_mechanics
	alert_icon_index = 5
	available = {
		OR = {
			has_dlc = "Cradle of Civilization"
			has_dlc = "King of Kings"
		}
	}

	powers = {
		tribal_allegiance = {
			max = 100
			reset_on_new_ruler = no
			base_monthly_growth = 0
			development_scaled_capped_monthly_growth = -0.25
			development_scale_cap = 1
			
			scaled_modifier = {
				modifier = {
					manpower_recovery_speed = 0.2
					global_unrest = -3
				}
			}
		}
	}
	
	interactions = {
		enlist_general = {
			icon = GFX_enlist_general_button
			cost_type = tribal_allegiance
			cost = 40
			trigger = {
			}
			effect = {
				if = {
					limit = {
						OR = {
							ruler_has_personality = one_v_one_gec_selim_personality
							has_country_flag = ARB_upgrade_enlist_general_flag
						}
					}
					create_general = {
						tradition = 80
					}
				}
				else = {
					create_general = {
						tradition = 40
					}
				}
			}
			cooldown_years = 0
			ai_chance = {
				factor = 1
				modifier = {
					factor = 0
					is_at_war = no
				}
				modifier = {
					factor = 10
					is_in_important_war = yes
					has_government_power = {
						mechanic_type = tribal_federation_mechanic
						power_type = tribal_allegiance
						value = 95
					}
				}
				modifier = {
					factor = 2
					not = { 
						has_leaders = {
							value = 1
							type = general
							include_monarch = no
							include_heir = no
						}
					}
				}
				modifier = {
					factor = 2
					not = { 
						has_leaders = {
							value = 2
							type = general
							include_monarch = no
							include_heir = no
						}
					}
				}
				modifier = {
					factor = 2
					not = { 
						has_leader_with = {
							general = yes
							total_pips = 6
						}
					}
				}
				modifier = {
					factor = 0.1
					has_leader_with = {
						general = yes
						total_pips = 11
					}
				}
			}
		}
		
		train_horsemanship = {
			icon = GFX_train_horsemanship_button
			cost_type = tribal_allegiance
			cost = 40
			trigger = {
				NOT = { has_country_modifier = ABR_train_horsemanship_modifier_upgraded }
				NOT = { has_country_modifier = train_horsemanship_modifier }
			}
			effect = {
				if = {
					limit = {
						OR = {
							ruler_has_personality = one_v_one_gec_selim_personality
							has_country_flag = ARB_upgrade_enlist_general_flag
						}
					}
					add_country_modifier = {
						name = one_v_one_train_horsemanship_modifier_upgraded
						duration = 1825
					}
				}
				else = {
					add_country_modifier = {
						name = train_horsemanship_modifier
						duration = 1825
					}
				}
			}
			cooldown_years = 0
			ai_chance = {
				factor = 1
				modifier = {
					factor = 0
					not = { cavalry_fraction = 0.1 }
				}
				modifier = {
					factor = 0
					is_at_war = no
				}
				modifier = {
					factor = 0
					NOT = { manpower_percentage = 0.8 }
				}
				modifier = {
					factor = 10
					is_in_important_war = yes
					has_government_power = {
						mechanic_type = tribal_federation_mechanic
						power_type = tribal_allegiance
						value = 95
					}
				}
				modifier = {
					factor = 0.1
					not = { cavalry_fraction = 0.2 }
				}
			}
		}
		
		conscript_from_tribes = {
			icon = GFX_conscript_from_tribes_button
			cost_type = tribal_allegiance
			cost = 40
			trigger = {
				any_owned_province = {
					has_siege = no
					controlled_by = ROOT
				}
			}
			effect = {
				if = {
					limit = {
						ruler_has_personality = one_v_one_gec_selim_personality
					}
					if = {
						limit = {
							capital_scope = {
								OR = {
									has_siege = yes
									NOT = { controlled_by = ROOT }
								}
							}
							2299 = {
								has_siege = no
								controlled_by = ROOT
							}
						}
						2299 = {
							add_unit_construction = {
								type = cavalry
								amount = 30
								speed = 0.1
								cost = 0
							}
						}
					}
					else_if = {
						limit = {
							2299 = {
								OR = {
									has_siege = yes
									NOT = { controlled_by = ROOT }
								}
							}
							capital_scope = {
								OR = {
									has_siege = yes
									NOT = { controlled_by = ROOT }
								}
							}
						}
						random_owned_province = {
							limit = {
								has_siege = no
								controlled_by = ROOT
							}
							add_unit_construction = {
								type = cavalry
								amount = 30
								speed = 0.1
								cost = 0
							}
						}
					}
					else = {
						capital_scope = {
							add_unit_construction = {
								type = cavalry
								amount = 30
								speed = 0.1
								cost = 0
							}
						}
					}
				}
				else = {
					if = {
						limit = {
							capital_scope = {
								OR = {
									has_siege = yes
									NOT = { controlled_by = ROOT }
								}
							}
						}
						random_owned_province = {
							limit = {
								has_siege = no
								controlled_by = ROOT
							}
							add_unit_construction = {
								type = cavalry
								amount = 6
								speed = 0.25
								cost = 0
							}
						}
					}
					else = {
						capital_scope = {
							add_unit_construction = {
								type = cavalry
								amount = 6
								speed = 0.25
								cost = 0
							}
						}
					}
				}
				if = {
					limit = {
						OR = {
							has_country_flag = turkoman_safavids_conscripted
							has_country_flag = ARB_upgrade_conscript_from_the_tribes_flag
						}
					}
					custom_tooltip = " "
					
					add_yearly_manpower = 1
				}
			}
			cooldown_years = 0
			ai_chance = {
				factor = 0	#Just no
			}
		}
	}
}